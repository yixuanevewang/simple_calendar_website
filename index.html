<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interactive Learning Calendar (Large)</title>
    
    <style>
        /* Base Reset & Variables */
        :root {
            --bg-color: #f0f9ff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #2563eb;
            --accent-light: #eff6ff;
            --white: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* No scroll */
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Main Container - fills most of the screen */
        .container {
            width: 96vw;
            height: 85vh; /* Reduced from 92vh to prevent bottom cutoff */
            display: flex;
            flex-direction: column;
            gap: 1vh;
        }

        /* Header Section */
        .header-card {
            background: var(--white);
            border-radius: 20px;
            padding: 1vh 2vh;
            text-align: center;
            box-shadow: var(--shadow);
            flex-shrink: 0; /* Don't shrink */
            display: flex;
            flex-direction: row; /* Changed to row for side-by-side */
            justify-content: center;
            align-items: center; /* Vertically align centers */
            height: 14vh; /* Reduced from 16vh */
            gap: 4vh; /* Space between Month and Year */
        }

        .month-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
        }

        .month-en {
            font-size: 5vh; /* Reduced from 6vh */
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
            transition: all 0.2s;
        }

        .month-zh {
            font-size: 2.5vh; /* Reduced from 3vh */
            font-weight: 500;
            color: var(--text-secondary);
            margin-top: 0.5vh;
            transition: all 0.2s;
        }

        .year-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
        }

        .year-text {
            font-size: 5vh; /* Reduced from 6vh */
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1;
            transition: all 0.2s;
        }
        
        /* Placeholder for year subtitle if needed, or just visual balance */
        .year-sub {
            font-size: 1.5vh; /* Reduced */
            color: transparent; /* Keep layout stable */
            margin-top: 0.5vh;
        }

        .tap-hint {
            font-size: 1.2vh; /* Reduced */
            color: #cbd5e1;
            margin-top: 0.5vh;
        }

        /* Calendar Section */
        .calendar-card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow);
            flex-grow: 1; /* Take up remaining height */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Weekday Header */
        .grid-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            height: 7vh; /* Reduced from 8vh */
        }

        .weekday-cell {
            display: flex;
            flex-direction: column; /* Stack EN and ZH */
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-right: 1px solid #f1f5f9;
            transition: background-color 0.2s;
            padding: 0.5vh 0;
        }
        .weekday-cell:last-child { border-right: none; }

        .weekday-cell:active {
            background-color: #dbeafe;
        }

        .weekday-en {
            font-size: 1.6vh; /* Reduced from 1.8vh */
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            transition: color 0.2s;
        }

        .weekday-zh {
            font-size: 1.2vh; /* Reduced from 1.4vh */
            font-weight: 400;
            color: #94a3b8;
            margin-top: 0.5vh;
            transition: color 0.2s;
        }

        /* Days Grid */
        .grid-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            /* Auto-fill rows to fill the remaining height equally */
            grid-auto-rows: 1fr; 
            flex-grow: 1;
            background-color: #e2e8f0; /* Borders */
            gap: 2px;
            padding: 2px;
        }

        /* --- Day Cell Styles --- */
        .day-cell {
            background-color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5vh; /* Reduced from 4vh */
            font-weight: 500;
            position: relative;
            cursor: pointer;
            color: var(--text-primary);
            transition: background-color 0.2s, border-color 0.2s;
            border: 4px solid transparent; 
        }

        .day-cell:active {
            background-color: #bfdbfe;
        }

        /* States */
        .day-cell.today {
            background-color: var(--accent-blue);
            color: var(--white);
            font-weight: 800;
            font-size: 4.5vh; /* Reduced from 5vh */
        }
        
        .day-cell.today:active {
            background-color: #1d4ed8;
        }

        .day-cell.near-date { /* Yesterday/Tomorrow */
            background-color: #eff6ff;
            color: var(--accent-blue);
            font-weight: 700;
        }

        /* Indicators */
        .dot-indicator {
            position: absolute;
            bottom: 0.5vh; 
            width: 0.8vh; /* Slightly smaller dot */
            height: 0.8vh;
            background-color: #60a5fa;
            border-radius: 50%;
        }

        .day-cell.today .dot-indicator {
            background-color: var(--white);
            opacity: 0.8;
        }

        /* --- Active Speaking States --- */
        
        /* For the Date Box */
        .day-cell.speaking {
            border-color: var(--accent-blue); 
            background-color: #dbeafe; 
        }
        
        .day-cell.today.speaking {
            border-color: var(--white);
            background-color: #1e40af; 
        }

        /* For Text Headers */
        .text-highlight {
            color: var(--accent-blue) !important;
            transform: scale(1.1);
            text-shadow: 0 0 10px rgba(37, 99, 235, 0.3);
            font-weight: 800;
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="header-card" id="headerCard">
            <!-- Month Container -->
            <div class="month-block" id="monthBlock">
                <div class="month-en" id="monthEn">...</div>
                <div class="month-zh" id="monthZh">...</div>
            </div>
            
            <!-- Year Container -->
            <div class="year-container" id="yearBlock">
                <span class="year-text" id="yearDisplay">...</span>
                <span class="tap-hint">(Tap text to listen)</span>
            </div>
        </div>

        <!-- Calendar -->
        <div class="calendar-card">
            <!-- Weekdays -->
            <div class="grid-header" id="weekdayHeader">
                <!-- Injected via JS -->
            </div>
            
            <!-- Days -->
            <div class="grid-days" id="calendarGrid">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <script>
        // --- Data ---
        const WEEKDAYS = [
            { en: 'Sunday', zh: '星期日' },
            { en: 'Monday', zh: '星期一' },
            { en: 'Tuesday', zh: '星期二' },
            { en: 'Wednesday', zh: '星期三' },
            { en: 'Thursday', zh: '星期四' },
            { en: 'Friday', zh: '星期五' },
            { en: 'Saturday', zh: '星期六' }
        ];

        const MONTHS = [
            { en: 'January', zh: '一月' },
            { en: 'February', zh: '二月' },
            { en: 'March', zh: '三月' },
            { en: 'April', zh: '四月' },
            { en: 'May', zh: '五月' },
            { en: 'June', zh: '六月' },
            { en: 'July', zh: '七月' },
            { en: 'August', zh: '八月' },
            { en: 'September', zh: '九月' },
            { en: 'October', zh: '十月' },
            { en: 'November', zh: '十一月' },
            { en: 'December', zh: '十二月' }
        ];

        // --- State ---
        let currentDate = new Date();

        // --- Speech Logic ---
        function playSequence(segments) {
            if (!window.speechSynthesis) return;

            window.speechSynthesis.cancel();

            // Clear old highlights
            document.querySelectorAll('.speaking, .text-highlight').forEach(el => {
                el.classList.remove('speaking', 'text-highlight');
            });

            let index = 0;

            function playNext() {
                if (index >= segments.length) return;

                const seg = segments[index];
                const utterance = new SpeechSynthesisUtterance(seg.text);
                utterance.lang = seg.lang;
                utterance.rate = 0.4; 

                // Highlight ON
                utterance.onstart = () => {
                    if (seg.el) {
                        if (seg.el.classList.contains('day-cell')) {
                            seg.el.classList.add('speaking');
                        } else {
                            seg.el.classList.add('text-highlight');
                        }
                    }
                };

                // Highlight OFF & Next
                const finish = () => {
                    if (seg.el) {
                        seg.el.classList.remove('speaking');
                        seg.el.classList.remove('text-highlight');
                    }
                    index++;
                    playNext();
                };

                utterance.onend = finish;
                utterance.onerror = finish;

                window.speechSynthesis.speak(utterance);
            }

            playNext();
        }

        // --- Helpers ---
        function getOrdinal(n) {
            const s = ["th", "st", "nd", "rd"];
            const v = n % 100;
            return n + (s[(v - 20) % 10] || s[v] || s[0]);
        }

        function isSameDay(d1, d2) {
            return d1.getFullYear() === d2.getFullYear() &&
                   d1.getMonth() === d2.getMonth() &&
                   d1.getDate() === d2.getDate();
        }

        // --- Rendering ---
        function renderCalendar() {
            try {
                const now = new Date();
                currentDate = now;

                const year = now.getFullYear();
                const month = now.getMonth();

                // 1. Setup Header Elements
                const monthBlock = document.getElementById('monthBlock');
                const monthEnEl = document.getElementById('monthEn');
                const monthZhEl = document.getElementById('monthZh');
                
                const yearBlock = document.getElementById('yearBlock');
                const yearDisplay = document.getElementById('yearDisplay');
                
                if (monthEnEl && monthZhEl) {
                    monthEnEl.textContent = MONTHS[month].en;
                    monthZhEl.textContent = MONTHS[month].zh;
                    
                    monthBlock.onclick = (e) => {
                        e.stopPropagation();
                        // Highlight En, then Zh specific elements
                        playSequence([
                            { text: MONTHS[month].en, lang: 'en-US', el: monthEnEl },
                            { text: MONTHS[month].zh, lang: 'zh-CN', el: monthZhEl }
                        ]);
                    };
                }
                
                if (yearDisplay) {
                    yearDisplay.textContent = year;
                    yearBlock.onclick = (e) => {
                        e.stopPropagation();
                        // Highlight Year (shared element)
                        playSequence([
                            { text: `${year}`, lang: 'en-US', el: yearDisplay },
                            { text: `${year}年`, lang: 'zh-CN', el: yearDisplay }
                        ]);
                    };
                }

                // 2. Render Weekdays
                const weekdayContainer = document.getElementById('weekdayHeader');
                // Store references to separate EN/ZH elements for each day
                const weekdayRefs = []; 

                if (weekdayContainer) {
                    weekdayContainer.innerHTML = '';
                    WEEKDAYS.forEach((day, index) => {
                        const cell = document.createElement('div');
                        cell.className = 'weekday-cell';
                        cell.id = `weekday-${index}`; 
                        
                        const textEn = document.createElement('span');
                        textEn.className = 'weekday-en';
                        textEn.textContent = day.en;
                        
                        const textZh = document.createElement('span');
                        textZh.className = 'weekday-zh';
                        textZh.textContent = day.zh;
                        
                        cell.appendChild(textEn);
                        cell.appendChild(textZh);
                        
                        cell.onclick = () => {
                            playSequence([
                                { text: day.en, lang: 'en-US', el: textEn },
                                { text: day.zh, lang: 'zh-CN', el: textZh }
                            ]);
                        };
                        
                        weekdayContainer.appendChild(cell);
                        weekdayRefs.push({ en: textEn, zh: textZh });
                    });
                }

                // 3. Render Days
                const daysContainer = document.getElementById('calendarGrid');
                if (daysContainer) {
                    daysContainer.innerHTML = '';

                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    const firstDayIndex = new Date(year, month, 1).getDay();

                    // Blanks
                    for (let i = 0; i < firstDayIndex; i++) {
                        const blank = document.createElement('div');
                        blank.className = 'day-cell';
                        blank.style.cursor = 'default';
                        blank.style.backgroundColor = '#f8fafc'; 
                        daysContainer.appendChild(blank);
                    }

                    // Days
                    for (let i = 1; i <= daysInMonth; i++) {
                        const cell = document.createElement('div');
                        cell.className = 'day-cell';
                        cell.textContent = i;

                        const cellDate = new Date(year, month, i);
                        const realNow = new Date();
                        
                        const yesterday = new Date(realNow);
                        yesterday.setDate(realNow.getDate() - 1);
                        
                        const tomorrow = new Date(realNow);
                        tomorrow.setDate(realNow.getDate() + 1);

                        const isToday = isSameDay(cellDate, realNow);
                        const isYest = isSameDay(cellDate, yesterday);
                        const isTom = isSameDay(cellDate, tomorrow);

                        if (isToday) {
                            cell.classList.add('today');
                            const dot = document.createElement('div');
                            dot.className = 'dot-indicator';
                            cell.appendChild(dot);
                        } else if (isYest || isTom) {
                            cell.classList.add('near-date');
                            const dot = document.createElement('div');
                            dot.className = 'dot-indicator';
                            cell.appendChild(dot);
                        }

                        cell.onclick = () => {
                            const weekdayIndex = cellDate.getDay();
                            
                            // Prefix Text Logic
                            let prefixEn = "";
                            let prefixZh = "";
                            if (isToday) {
                                prefixEn = "Today is ";
                                prefixZh = "今天是 ";
                            } else if (isYest) {
                                prefixEn = "Yesterday was ";
                                prefixZh = "昨天是 ";
                            } else if (isTom) {
                                prefixEn = "Tomorrow is ";
                                prefixZh = "明天是 ";
                            }

                            // Karaoke Sequence
                            const sequence = [
                                // --- ENGLISH ---
                                { text: prefixEn, lang: 'en-US', el: null },
                                { text: `${WEEKDAYS[weekdayIndex].en},`, lang: 'en-US', el: weekdayRefs[weekdayIndex].en },
                                { text: MONTHS[month].en, lang: 'en-US', el: monthEnEl },
                                { text: `${getOrdinal(i)},`, lang: 'en-US', el: cell },
                                { text: `${year}.`, lang: 'en-US', el: yearDisplay },
                                
                                // --- CHINESE ---
                                { text: prefixZh, lang: 'zh-CN', el: null },
                                { text: `${WEEKDAYS[weekdayIndex].zh},`, lang: 'zh-CN', el: weekdayRefs[weekdayIndex].zh },
                                { text: `${year}年`, lang: 'zh-CN', el: yearDisplay },
                                { text: `${MONTHS[month].zh}`, lang: 'zh-CN', el: monthZhEl },
                                { text: `${i}日`, lang: 'zh-CN', el: cell }
                            ];
                            
                            const finalSequence = sequence.filter(s => s.text !== "");
                            playSequence(finalSequence);
                        };

                        daysContainer.appendChild(cell);
                    }

                    // Fill remaining slots
                    const totalCells = firstDayIndex + daysInMonth;
                    const remaining = 7 - (totalCells % 7);
                    if (remaining < 7) {
                        for (let i = 0; i < remaining; i++) {
                            const blank = document.createElement('div');
                            blank.className = 'day-cell';
                            blank.style.cursor = 'default';
                            blank.style.backgroundColor = '#f8fafc';
                            daysContainer.appendChild(blank);
                        }
                    }
                }
            } catch (err) {
                console.error("Calendar render error:", err);
            }
        }

        renderCalendar();
        window.addEventListener('load', renderCalendar);
        setInterval(renderCalendar, 60000);

    </script>
</body>
</html>
