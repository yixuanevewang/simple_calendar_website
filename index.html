<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interactive Learning Calendar (Large)</title>
    
    <style>
        /* Base Reset & Variables */
        :root {
            --bg-color: #f0f9ff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #2563eb;
            --accent-light: #eff6ff;
            --white: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* No scroll */
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Main Container - fills most of the screen */
        .container {
            width: 96vw;
            height: 96vh;
            display: flex;
            flex-direction: column;
            gap: 1.5vh;
        }

        /* Header Section */
        .header-card {
            background: var(--white);
            border-radius: 20px;
            padding: 1.5vh;
            text-align: center;
            box-shadow: var(--shadow);
            flex-shrink: 0; /* Don't shrink */
            display: flex;
            flex-direction: row; /* Changed to row for side-by-side */
            justify-content: center;
            align-items: center; /* Vertically align centers */
            height: 18vh; /* Fixed height portion for header */
            gap: 2vh; /* Space between Month and Year */
        }

        .month-title {
            font-size: 8vh; /* Responsive font size based on height */
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0 10px;
            margin: 0; /* Remove default margins */
        }

        .month-title:active {
            color: var(--accent-blue);
            opacity: 0.7;
        }

        .year-container {
            margin-top: 0; /* Removed top margin */
            display: flex;
            align-items: baseline; /* Align text baselines */
            justify-content: center;
            gap: 15px;
        }

        .year-text {
            font-size: 8vh; /* Increased from 4vh to match Month */
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .year-text:active {
            background-color: var(--accent-light);
            color: var(--accent-blue);
        }

        .tap-hint {
            font-size: 2vh;
            color: #cbd5e1;
            /* margin-top removed as it's now inline/baseline */
        }

        /* Calendar Section */
        .calendar-card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow);
            flex-grow: 1; /* Take up remaining height */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Weekday Header */
        .grid-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            height: 8vh; /* Fixed height for weekday names */
        }

        .weekday-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-right: 1px solid #f1f5f9;
            transition: background-color 0.2s;
        }
        .weekday-cell:last-child { border-right: none; }

        .weekday-cell:active {
            background-color: #dbeafe;
        }

        .weekday-text {
            font-size: 3vh; /* Large text */
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            transition: color 0.2s;
        }

        /* Days Grid */
        .grid-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            /* Auto-fill rows to fill the remaining height equally */
            grid-auto-rows: 1fr; 
            flex-grow: 1;
            background-color: #e2e8f0; /* Borders */
            gap: 2px;
            padding: 2px;
        }

        /* --- Day Cell Styles --- */
        .day-cell {
            background-color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5vh; /* Very large numbers */
            font-weight: 500;
            position: relative;
            cursor: pointer;
            color: var(--text-primary);
            transition: background-color 0.2s, border-color 0.2s;
            border: 4px solid transparent; /* Add transparent border to prevent layout shift */
        }

        .day-cell:active {
            background-color: #bfdbfe;
        }

        /* States */
        .day-cell.today {
            background-color: var(--accent-blue);
            color: var(--white);
            font-weight: 800;
            font-size: 6vh; /* Pop even more */
        }
        
        .day-cell.today:active {
            background-color: #1d4ed8;
        }

        .day-cell.near-date { /* Yesterday/Tomorrow */
            background-color: #eff6ff;
            color: var(--accent-blue);
            font-weight: 700;
        }

        /* Indicators */
        .dot-indicator {
            position: absolute;
            bottom: 0.5vh; /* UPDATED: Moved further down (was 1.5vh) */
            width: 1.2vh;
            height: 1.2vh;
            background-color: #60a5fa;
            border-radius: 50%;
        }

        .day-cell.today .dot-indicator {
            background-color: var(--white);
            opacity: 0.8;
        }

        /* --- Active Speaking States --- */
        
        /* For the Date Box */
        .day-cell.speaking {
            border-color: var(--accent-blue); 
            background-color: #dbeafe; /* Light blue highlight */
        }
        
        .day-cell.today.speaking {
            border-color: var(--white);
            background-color: #1e40af; /* Darker blue highlight */
        }

        /* For Text Headers (Month, Year, Weekdays) */
        .text-highlight {
            color: var(--accent-blue) !important;
            transform: scale(1.1);
            text-shadow: 0 0 10px rgba(37, 99, 235, 0.3);
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="header-card" id="headerCard">
            <!-- Placeholders will be replaced by JS immediately -->
            <div class="month-title" id="monthDisplay">...</div>
            <div class="year-container">
                <span class="year-text" id="yearDisplay">...</span>
                <span class="tap-hint">(Tap text to listen)</span>
            </div>
        </div>

        <!-- Calendar -->
        <div class="calendar-card">
            <!-- Weekdays -->
            <div class="grid-header" id="weekdayHeader">
                <!-- Injected via JS -->
            </div>
            
            <!-- Days -->
            <div class="grid-days" id="calendarGrid">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <script>
        // --- Data ---
        const WEEKDAYS = [
            { en: 'Sunday', zh: '星期日' },
            { en: 'Monday', zh: '星期一' },
            { en: 'Tuesday', zh: '星期二' },
            { en: 'Wednesday', zh: '星期三' },
            { en: 'Thursday', zh: '星期四' },
            { en: 'Friday', zh: '星期五' },
            { en: 'Saturday', zh: '星期六' }
        ];

        const MONTHS = [
            { en: 'January', zh: '一月' },
            { en: 'February', zh: '二月' },
            { en: 'March', zh: '三月' },
            { en: 'April', zh: '四月' },
            { en: 'May', zh: '五月' },
            { en: 'June', zh: '六月' },
            { en: 'July', zh: '七月' },
            { en: 'August', zh: '八月' },
            { en: 'September', zh: '九月' },
            { en: 'October', zh: '十月' },
            { en: 'November', zh: '十一月' },
            { en: 'December', zh: '十二月' }
        ];

        // --- State ---
        let currentDate = new Date();

        // --- NEW Advanced Speech Logic (Sequential/Karaoke) ---
        
        // This function manages a strict queue of speech events
        // It plays one segment, highlights its element, waits for end, un-highlights, then plays next.
        function playSequence(segments) {
            if (!window.speechSynthesis) return;

            // 1. Clear any existing speech
            window.speechSynthesis.cancel();

            // 2. Remove any stuck highlights from previous runs
            document.querySelectorAll('.speaking, .text-highlight').forEach(el => {
                el.classList.remove('speaking', 'text-highlight');
            });

            let index = 0;

            function playNext() {
                if (index >= segments.length) return;

                const seg = segments[index];
                const utterance = new SpeechSynthesisUtterance(seg.text);
                utterance.lang = seg.lang;
                utterance.rate = 0.4; // Keep it slow

                // START Event: Turn ON highlight
                utterance.onstart = () => {
                    if (seg.el) {
                        if (seg.el.classList.contains('day-cell')) {
                            seg.el.classList.add('speaking');
                        } else {
                            seg.el.classList.add('text-highlight');
                        }
                    }
                };

                // END/ERROR Event: Turn OFF highlight and play NEXT
                const finish = () => {
                    if (seg.el) {
                        seg.el.classList.remove('speaking');
                        seg.el.classList.remove('text-highlight');
                    }
                    index++;
                    playNext(); // Recursively call next
                };

                utterance.onend = finish;
                utterance.onerror = finish;

                // Speak it
                window.speechSynthesis.speak(utterance);
            }

            // Start the chain
            playNext();
        }

        // --- Helpers ---
        function getOrdinal(n) {
            const s = ["th", "st", "nd", "rd"];
            const v = n % 100;
            return n + (s[(v - 20) % 10] || s[v] || s[0]);
        }

        function isSameDay(d1, d2) {
            return d1.getFullYear() === d2.getFullYear() &&
                   d1.getMonth() === d2.getMonth() &&
                   d1.getDate() === d2.getDate();
        }

        // --- Rendering ---
        function renderCalendar() {
            try {
                const now = new Date();
                currentDate = now;

                const year = now.getFullYear();
                const month = now.getMonth();

                // 1. Setup Header Elements
                const monthTitle = document.getElementById('monthDisplay');
                const yearDisplay = document.getElementById('yearDisplay');
                
                if (monthTitle) {
                    monthTitle.textContent = MONTHS[month].en;
                    monthTitle.onclick = (e) => {
                        e.stopPropagation();
                        // Sequence: En -> Zh (Highlight Month only)
                        playSequence([
                            { text: MONTHS[month].en, lang: 'en-US', el: monthTitle },
                            { text: MONTHS[month].zh, lang: 'zh-CN', el: monthTitle }
                        ]);
                    };
                }
                
                if (yearDisplay) {
                    yearDisplay.textContent = year;
                    yearDisplay.onclick = (e) => {
                        e.stopPropagation();
                        // Sequence: En -> Zh (Highlight Year only)
                        playSequence([
                            { text: `${year}`, lang: 'en-US', el: yearDisplay },
                            { text: `${year}年`, lang: 'zh-CN', el: yearDisplay }
                        ]);
                    };
                }

                // 2. Render Weekdays
                const weekdayContainer = document.getElementById('weekdayHeader');
                const weekdayElements = []; // Store references for easy access

                if (weekdayContainer) {
                    weekdayContainer.innerHTML = '';
                    WEEKDAYS.forEach((day, index) => {
                        const cell = document.createElement('div');
                        cell.className = 'weekday-cell';
                        cell.id = `weekday-${index}`; 
                        
                        const textSpan = document.createElement('span');
                        textSpan.className = 'weekday-text';
                        textSpan.textContent = day.en;
                        
                        cell.appendChild(textSpan);
                        
                        cell.onclick = () => {
                            // Sequence: En -> Zh (Highlight Weekday only)
                            playSequence([
                                { text: day.en, lang: 'en-US', el: textSpan },
                                { text: day.zh, lang: 'zh-CN', el: textSpan }
                            ]);
                        };
                        
                        weekdayContainer.appendChild(cell);
                        weekdayElements.push(textSpan);
                    });
                }

                // 3. Render Days
                const daysContainer = document.getElementById('calendarGrid');
                if (daysContainer) {
                    daysContainer.innerHTML = '';

                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    const firstDayIndex = new Date(year, month, 1).getDay();

                    // Add Blanks
                    for (let i = 0; i < firstDayIndex; i++) {
                        const blank = document.createElement('div');
                        blank.className = 'day-cell';
                        blank.style.cursor = 'default';
                        blank.style.backgroundColor = '#f8fafc'; 
                        daysContainer.appendChild(blank);
                    }

                    // Add Days
                    for (let i = 1; i <= daysInMonth; i++) {
                        const cell = document.createElement('div');
                        cell.className = 'day-cell';
                        cell.textContent = i;

                        const cellDate = new Date(year, month, i);
                        const realNow = new Date();
                        
                        const yesterday = new Date(realNow);
                        yesterday.setDate(realNow.getDate() - 1);
                        
                        const tomorrow = new Date(realNow);
                        tomorrow.setDate(realNow.getDate() + 1);

                        const isToday = isSameDay(cellDate, realNow);
                        const isYest = isSameDay(cellDate, yesterday);
                        const isTom = isSameDay(cellDate, tomorrow);

                        if (isToday) {
                            cell.classList.add('today');
                            const dot = document.createElement('div');
                            dot.className = 'dot-indicator';
                            cell.appendChild(dot);
                        } else if (isYest || isTom) {
                            cell.classList.add('near-date');
                            const dot = document.createElement('div');
                            dot.className = 'dot-indicator';
                            cell.appendChild(dot);
                        }

                        cell.onclick = () => {
                            const weekdayIndex = cellDate.getDay();
                            
                            // Prefix Text Logic
                            let prefixEn = "";
                            let prefixZh = "";
                            if (isToday) {
                                prefixEn = "Today is ";
                                prefixZh = "今天是 ";
                            } else if (isYest) {
                                prefixEn = "Yesterday was ";
                                prefixZh = "昨天是 ";
                            } else if (isTom) {
                                prefixEn = "Tomorrow is ";
                                prefixZh = "明天是 ";
                            }

                            // Build the Karaoke Sequence
                            const sequence = [
                                // --- ENGLISH ---
                                // 1. Prefix (No Highlight)
                                { text: prefixEn, lang: 'en-US', el: null },
                                // 2. Weekday
                                { text: `${WEEKDAYS[weekdayIndex].en},`, lang: 'en-US', el: weekdayElements[weekdayIndex] },
                                // 3. Month
                                { text: MONTHS[month].en, lang: 'en-US', el: monthTitle },
                                // 4. Day Number
                                { text: `${getOrdinal(i)},`, lang: 'en-US', el: cell },
                                // 5. Year
                                { text: `${year}.`, lang: 'en-US', el: yearDisplay },
                                
                                // --- CHINESE ---
                                // 1. Prefix (No Highlight)
                                { text: prefixZh, lang: 'zh-CN', el: null },
                                // 2. Weekday
                                { text: `${WEEKDAYS[weekdayIndex].zh},`, lang: 'zh-CN', el: weekdayElements[weekdayIndex] },
                                // 3. Year (Chinese says Year first)
                                { text: `${year}年`, lang: 'zh-CN', el: yearDisplay },
                                // 4. Month
                                { text: `${MONTHS[month].zh}`, lang: 'zh-CN', el: monthTitle },
                                // 5. Day Number
                                { text: `${i}日`, lang: 'zh-CN', el: cell }
                            ];
                            
                            // Remove empty prefixes if not today/yest/tom
                            const finalSequence = sequence.filter(s => s.text !== "");

                            playSequence(finalSequence);
                        };

                        daysContainer.appendChild(cell);
                    }

                    // Fill remaining slots
                    const totalCells = firstDayIndex + daysInMonth;
                    const remaining = 7 - (totalCells % 7);
                    if (remaining < 7) {
                        for (let i = 0; i < remaining; i++) {
                            const blank = document.createElement('div');
                            blank.className = 'day-cell';
                            blank.style.cursor = 'default';
                            blank.style.backgroundColor = '#f8fafc';
                            daysContainer.appendChild(blank);
                        }
                    }
                }
            } catch (err) {
                console.error("Calendar render error:", err);
            }
        }

        renderCalendar();
        window.addEventListener('load', renderCalendar);
        setInterval(renderCalendar, 60000);

    </script>
</body>
</html>
