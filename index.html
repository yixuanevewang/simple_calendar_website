<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interactive Learning Calendar</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #f0f9ff;
            touch-action: manipulation; /* Improves touch response */
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }
        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar {
            display: none;
        }
        /* Prevent text selection to make it feel more like an app */
        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Data Helpers
        const WEEKDAYS = [
            { en: 'Sunday', zh: '星期日' },
            { en: 'Monday', zh: '星期一' },
            { en: 'Tuesday', zh: '星期二' },
            { en: 'Wednesday', zh: '星期三' },
            { en: 'Thursday', zh: '星期四' },
            { en: 'Friday', zh: '星期五' },
            { en: 'Saturday', zh: '星期六' }
        ];

        const MONTHS = [
            { en: 'January', zh: '一月' },
            { en: 'February', zh: '二月' },
            { en: 'March', zh: '三月' },
            { en: 'April', zh: '四月' },
            { en: 'May', zh: '五月' },
            { en: 'June', zh: '六月' },
            { en: 'July', zh: '七月' },
            { en: 'August', zh: '八月' },
            { en: 'September', zh: '九月' },
            { en: 'October', zh: '十月' },
            { en: 'November', zh: '十一月' },
            { en: 'December', zh: '十二月' }
        ];

        // Speech Helper Function
        const speak = (textEn, textZh) => {
            if (!window.speechSynthesis) return;

            // Cancel any current speech
            window.speechSynthesis.cancel();

            // English Utterance
            const utteranceEn = new SpeechSynthesisUtterance(textEn);
            utteranceEn.lang = 'en-US';
            utteranceEn.rate = 0.8; // Slower speed

            // Chinese Utterance
            const utteranceZh = new SpeechSynthesisUtterance(textZh);
            utteranceZh.lang = 'zh-CN';
            utteranceZh.rate = 0.8; 

            // Chain them: Play Chinese only after English finishes
            // This fixes the issue on iOS/Android where they overlap or cancel out
            utteranceEn.onend = () => {
                window.speechSynthesis.speak(utteranceZh);
            };

            window.speechSynthesis.speak(utteranceEn);
        };

        const App = () => {
            const [now, setNow] = useState(new Date());

            // Update time every minute to catch midnight transitions
            useEffect(() => {
                const timer = setInterval(() => {
                    setNow(new Date());
                }, 60000);
                return () => clearInterval(timer);
            }, []);

            const currentYear = now.getFullYear();
            const currentMonthIndex = now.getMonth();
            const currentDay = now.getDate();

            // Calendar Logic
            const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
            const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

            const daysInMonth = getDaysInMonth(currentYear, currentMonthIndex);
            const startDay = getFirstDayOfMonth(currentYear, currentMonthIndex);

            // Generate calendar cells
            const blanks = Array(startDay).fill(null);
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            const totalSlots = [...blanks, ...days];

            // Date Comparison Helpers
            const isToday = (day) => {
                return day === currentDay;
            };

            const isYesterday = (day) => {
                const checkDate = new Date(currentYear, currentMonthIndex, day);
                const yesterday = new Date(now);
                yesterday.setDate(now.getDate() - 1);
                return checkDate.toDateString() === yesterday.toDateString();
            };

            const isTomorrow = (day) => {
                const checkDate = new Date(currentYear, currentMonthIndex, day);
                const tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                return checkDate.toDateString() === tomorrow.toDateString();
            };

            // Click Handlers
            const handleHeaderClick = () => {
                const enText = `${MONTHS[currentMonthIndex].en} ${currentYear}`;
                const zhText = `${currentYear}年 ${MONTHS[currentMonthIndex].zh}`;
                speak(enText, zhText);
            };

            const handleWeekdayClick = (index) => {
                speak(WEEKDAYS[index].en, WEEKDAYS[index].zh);
            };

            const handleDateClick = (day) => {
                if (!day) return;

                const dateObj = new Date(currentYear, currentMonthIndex, day);
                const weekdayIndex = dateObj.getDay();
                
                // Helper to get ordinal suffix (st, nd, rd, th)
                const getOrdinal = (n) => {
                    const s = ["th", "st", "nd", "rd"];
                    const v = n % 100;
                    return n + (s[(v - 20) % 10] || s[v] || s[0]);
                };

                const dateStringEn = `${MONTHS[currentMonthIndex].en} ${getOrdinal(day)}, ${currentYear}`;
                // Chinese date format: X年 X月 X日
                const dateStringZh = `${currentYear}年${MONTHS[currentMonthIndex].zh}${day}日`;
                const weekdayEn = WEEKDAYS[weekdayIndex].en;
                const weekdayZh = WEEKDAYS[weekdayIndex].zh;

                if (isToday(day)) {
                    speak(
                        `Today is ${weekdayEn}, ${dateStringEn}`, 
                        `今天是${weekdayZh}, ${dateStringZh}`
                    );
                } else if (isYesterday(day)) {
                    speak(
                        `Yesterday was ${weekdayEn}, ${dateStringEn}`, 
                        `昨天是${weekdayZh}, ${dateStringZh}`
                    );
                } else if (isTomorrow(day)) {
                    speak(
                        `Tomorrow is ${weekdayEn}, ${dateStringEn}`, 
                        `明天是${weekdayZh}, ${dateStringZh}`
                    );
                } else {
                    // Standard date reading
                    speak(
                        `${weekdayEn}, ${dateStringEn}`, 
                        `${weekdayZh}, ${dateStringZh}`
                    );
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-start py-6 px-2 sm:px-4 no-select">
                    
                    {/* Header Card */}
                    <div 
                        onClick={handleHeaderClick}
                        className="bg-white w-full max-w-lg rounded-2xl shadow-lg p-6 mb-4 text-center cursor-pointer hover:bg-blue-50 transition-colors active:scale-95 transform duration-150"
                    >
                        <h1 className="text-4xl sm:text-5xl font-bold text-slate-800">
                            {MONTHS[currentMonthIndex].en}
                        </h1>
                        <h2 className="text-2xl sm:text-3xl text-slate-500 mt-2 font-medium">
                            {currentYear}
                        </h2>
                        <p className="text-xs text-slate-300 mt-2">(Tap to listen / 点击听)</p>
                    </div>

                    {/* Calendar Grid Container */}
                    <div className="bg-white w-full max-w-lg rounded-2xl shadow-xl overflow-hidden">
                        
                        {/* Weekday Headers */}
                        <div className="grid grid-cols-7 bg-slate-100 border-b border-slate-200">
                            {WEEKDAYS.map((day, index) => (
                                <div 
                                    key={day.en}
                                    onClick={() => handleWeekdayClick(index)}
                                    className="h-14 sm:h-16 flex items-center justify-center p-1 cursor-pointer hover:bg-blue-100 transition-colors"
                                >
                                    {/* Responsive text: Small on mobile to fit "Wednesday", larger on desktop */}
                                    <span className="text-[0.65rem] sm:text-sm font-bold text-slate-600 uppercase tracking-tight break-words text-center leading-tight">
                                        {day.en}
                                    </span>
                                </div>
                            ))}
                        </div>

                        {/* Days Grid */}
                        <div className="grid grid-cols-7 gap-px bg-slate-200">
                            {totalSlots.map((day, index) => {
                                // Determine styling based on date status
                                const today = day && isToday(day);
                                const clickable = !!day;
                                
                                let bgClass = "bg-white"; // Default
                                let textClass = "text-slate-700";
                                
                                if (today) {
                                    bgClass = "bg-blue-600";
                                    textClass = "text-white font-bold";
                                } else if (day && (isYesterday(day) || isTomorrow(day))) {
                                    bgClass = "bg-blue-50"; 
                                    textClass = "text-blue-600 font-semibold";
                                }

                                return (
                                    <div 
                                        key={index}
                                        onClick={() => handleDateClick(day)}
                                        className={`
                                            aspect-[4/5] sm:aspect-square 
                                            flex items-center justify-center 
                                            text-lg sm:text-2xl 
                                            relative
                                            transition-colors duration-200
                                            ${bgClass} ${textClass}
                                            ${clickable ? 'cursor-pointer hover:bg-opacity-80 active:bg-blue-200' : ''}
                                            ${today ? 'hover:bg-blue-700' : ''}
                                        `}
                                    >
                                        {day}
                                        
                                        {/* Little dot indicators for Yesterday/Tomorrow for visual aid */}
                                        {day && isYesterday(day) && (
                                            <span className="absolute bottom-1 w-1 h-1 rounded-full bg-blue-400 opacity-50"></span>
                                        )}
                                        {day && isTomorrow(day) && (
                                            <span className="absolute bottom-1 w-1 h-1 rounded-full bg-blue-400 opacity-50"></span>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="mt-6 text-center text-slate-400 text-sm max-w-xs">
                        <p>Turn up your volume.</p>
                        <p>Tap headers or dates to hear them read aloud in English and Chinese.</p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
